<div id="grayout" ng-class="{grayout: grayout, animated: grayout, fadeOut: grayout}"></div>
<div class="well">
	<select class="form-control" ng-model="table" ng-options="table as table.name for table in tables track by table.id" ng-change="tableSelected(table.id)">
		<option value="">Select a trade...</option>
	</select>
	<select class="form-control" ng-model="type" ng-options="type as type.name for type in types | orderBy: 'name'" ng-change="typeSelected(type)" ng-disabled="!types">
		<option value="">Select an asset type...</option>
	</select>
</div>
<div class="alert" ng-show="alert" ng-class="{'alert-warning': alert.type == 'warning', 'alert-success': alert.type == 'success', 'alert-danger': alert.type == 'danger'}">
{{alert.message}}
</div>
<form name="assetForm" role="form" onsubmit="return false;" ng-show="fields.length > 0">
	<div ng-repeat="f in fields" class="form-group" ng-if="(!f.domain || f.domain.name.indexOf('NA_Domain') == -1) && hiddenFields.indexOf(f.name) == -1" ng-class="{'has-error': fieldForm.$invalid}">
		<ng-form name="fieldForm">
			<label class="control-label">{{f.alias}}</label>
			<select name="field" ng-if="f.name === 'SITE'" ng-model="f.value" ng-options="site as site.name for site in sites track by site.id | orderBy: 'name'" class="form-control" ng-change="siteSelected();building = undefined;" required>
				<option value="">Select a site...</option>
			</select>
			<select  name="field" ng-if="f.name === 'LOCATION'" ng-model="f.value" ng-options="building as building.name for building in buildings track by building.id | orderBy: 'name'" class="form-control" ng-disabled="!buildings || buildings.length == 0" ng-change="bldgSelected()" required>
				<option value="">Select a building...</option>
			</select>
			<!--domains-->
			<select name="field" ng-if="f.domain" ng-model="f.value" ng-options="cv.code as cv.name for cv in f.domain.codedValues" class="form-control" ng-required="{{!f.nullable}}">
				<option value="">Select a value...</option>
			</select>			
			<!--date input-->
			<div class="input-group date" ng-if="f.type == 'esriFieldTypeDate' && f.name != 'SITE' && f.name != 'LOCATION'" ng-init="dateInit()">
				<input name="field" class="form-control" ng-model="f.value" ng-maxlength="{{f.length}}" ng-required="{{!f.nullable}}"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span></input>
			</div>
			<!--asset tag-->
			<div ng-if="f.name === 'ASSET_TAG'">
				<div class="pull-left tag-prefix">{{prefix}} - </div>
				<input name="field" ng-model="f.value" ng-maxlength="{{f.length}}" ng-required="{{!f.nullable}}" ng-blur="inputBlur(f)" class="form-control tag-input" ng-pattern="/^\d+$/" autocomplete="off"></input>
			</div>
			<!--free form input-->
			<input name="field" ng-if="!f.domain && f.type != 'esriFieldTypeDate' && f.name != 'SITE' && f.name != 'LOCATION' && f.name!= 'ASSET_TAG'" ng-model="f.value" ng-maxlength="{{f.length}}" ng-required="{{!f.nullable}}" class="form-control" ng-class="{uppercase: uppercaseFields.indexOf(f.name) > -1}" autocomplete="off"></input>
	        <!--help blocks used for validation-->
	        <!--max length message-->
	        <span id="helpBlock" class="help-block" ng-if="fieldForm.field.$error.maxlength">Only accepts {{f.length}} characters</span>
	        <!--required message-->
	        <span id="helpBlock" class="help-block" ng-if="fieldForm.field.$error.required">This field requires a value</span>
	        <!--integer message-->
	        <span id="helpBlock" class="help-block" ng-if="fieldForm.field.$error.pattern">Only accepts integers</span>
			</ng-form>
	</div>
	<button type="submit" class="btn btn-success" ng-click="submitForm()" ng-show="type" ng-disabled="assetForm.$invalid || processing">{{((oid) ? 'Update' : 'Submit')}}</button>
	<button type="submit" class="btn btn-danger" ng-click="clearForm(true)" ng-show="type">Clear</button>
</form>